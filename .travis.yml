sudo: false
language: python
python:   
  - "3.5"
  - "3.6"

env:
  global:
    - PIPENV_VENV_IN_PROJECT=1
    - PIPENV_IGNORE_VIRTUALENVS=1
    - DATABASE_URL=postgresql://postgres:ONTOLOGY-DB@localhost:5433/ontology-db

services:
  - docker

before_install:
  - docker run --name ontology-orm-psql
  -p 5433:5433
  -e POSTGRES_DB=ontology-db
  -e POSTGRES_PASSWORD=ONTOLOGY-DB
  -d postgres

install:
  - pip install pipenv
  - pipenv install --three

script:
  - pipenv run python -c "from api.ontology_db.ontology_parser import parse_ontology; parse_ontology()"
  - pipenv run python -m pytest -v
  - pipenv run pytest --cov=./
  - pipenv run ./run.sh

after_success:
  - pipenv run codecov